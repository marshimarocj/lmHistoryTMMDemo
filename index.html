<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<!-- common -->
	<script src="js/timeglider-1.0.3/jquery-1.9.1.min.js"></script>
	<script src="js/underscore-min.js"></script>
	<script src="js/parseUri.js"></script>
	<script src="js/widget.js"></script>
	<!-- bootstrap -->
	<link rel="stylesheet" href="css/bootstrap-3.3.6/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-3.3.6/bootstrap-theme.min.css">
	<script src="js/bootstrap-3.3.6/bootstrap.min.js"></script>
	<!-- timeglider -->
</head>
<body>
	<!-- this is the banner of our demo-->
	<h1 id="pageHeader">Image Profiling for History Events</h1>
	<!-- use a tab widget -->
	<ul id="tabView">
		<li id="imgs">
			<!-- this section shows a list of selected images, -->
			<h2>What happened here in the past?</h2>
			<!-- use a carousel widget -->
			<div id="imgCarousel"></div>
		</li>
		<li id="events">
			<!-- this section shows a list of preprared events -->
			<h2>What do the events look like?</h2>
			<!-- list widget -->
			<div id="eventList"></div>
		</li>
		<li id="knowledge">
			<!-- this section shows all the events from different views on the time line-->
			<h2>Explore our history event knowledge base automatically extracted from images!</h2>
			<div id="timeview">
				<!-- this is a group of controls to select which subset of events to view on the time line -->
				<table>
					<tr>
						<td>
							<a href='#warList' id="warList">Browse by Period</a>
							<a href='#sceneList' id="sceneList">Browse by Scene</a>
							<a href='#objectList' id="objectList">Browse by Object</a>
						</td>
						<td>
							<div id="pageTable"></div>
						</td>
					</tr>
				</table>
				<!-- this is a timeglider widget for viewing events on time line -->
				<div id="timeglider"></div>
			</div>
		</li>
	</ul>

	<script>
var imgJsonUrl = '';
var eventJsonurl = '';
var browseJsonUrls = ['', '', ''];
var timeJsonUrl = '';
var timeRootJsonUrl = '';

var imgData = undefined;
var eventData = undefined;
var browseData = [undefined, undefined, undefined];

function pagedTableProcessFunc(item)
{
	// return the created element
}

function pagedTableClickFunc(item)
{
	var wordId = item[0];
	var jsonUrl = timeRootJsonUrl + wordId + '.json';
	var timeGlider = new TimeGlider($('#timeglider'));
	timeGlider.GetData(jsonUrl);
}

$(document).ready(function() {
	var pageHeader = new PageHeader($('#pageHeader'))
	var tabView = new TabView($('#tabView'))

	// image tab
	// d is a list of [imgId, imgUrl]
	$.getJSON(imgJsonUrl, function(d) {
		imgData = d;

		var imgCarousel = new Carousel($('#imgCarousel'), d, function(item) {
			//create and return img element
		});
		imgCarousel.SetItemClickFunc(function(item) {// link to match.html
			var iid = item[0];
			var url = 'match.html?iid' + iid;
			window.location = url;
		});
	});

	// event tab
	$('#events').click(function() {
		if(eventData != undefined) return;

		$.getJSON(imgJsonUrl, function(d) {
			eventData = d;

			// d is a list of [eid, text]
			var eventList = new ListView($('#eventList'), d, function(item) {
				//create and return div element which constains the text
			});
			eventList.SetItemClickFunc(function(item) {// link to event.html
				var eid = item[0];
				var url = 'event.html?eid' + eid;
				window.location = url;
			});
		});
	});

	// knowledge tab
	_.each(['#warList', '#sceneList', '#objectList'], function(d, i) {
		$(d).click(function() {
			if(browseData[i] != undefined){// refresh paged table with stored data
				var pagedTable = new PagedTable($('#pageTable'), d, param, pagedTableProcessFunc);
				pagedTable.SetItemClickFunc(pagedTableClickFunc);
			}
			else
			{
				// d is a list of [wordId, word]
				$.getJSON(browseJsonUrls[i], function (d) {// get data to refresh paged table
					browseData[i] = d;
					var param = {rows: 4, cols: 5};
					var pagedTable = new PagedTable($('#pageTable'), d, param, pagedTableProcessFunc);
					pagedTable.SetItemClickFunc(pagedTableClickFunc);
				});
			}
		});
	});

	// initialize timeGlider in knowledge tab
	var timeGlider = new TimeGlider($('#timeglider'));
	timeGlider.GetData(timeJsonUrl);
});
	</script>
</body>
