<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <!-- bootstrap -->
  <link rel="stylesheet" href="css/bootstrap-3.3.6/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-3.3.6/bootstrap-theme.min.css">

  <link rel="stylesheet" href="css/timeglider-1.0.3/jquery-ui-1.10.3.custom.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="css/timeglider-1.0.3/Timeglider.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="css/timeglider-1.0.3/timeglider.datepicker.css" type="text/css" media="screen" charset="utf-8">

  <link rel="stylesheet" href="css/index.css">
</head>
<body>
  <!-- this is the banner of our demo-->
  <!-- Fixed navbar -->
  <div class="navbar navbar-fixed-top">
    <div class="imglogo">
        <a href="index.html"><img src="img/logo.png"/></a>
    </div>
  </div>
  <!-- h1 id="pageHeader">Image Profiling for History Events</h1 -->
  <!-- use a tab widget -->
  <!-- Nav tab -->

  <div class="container theme-showcase" role="main">
    <ul class="nav nav-tabs" id="tabView">
      <li role="presentation" class="active">
        <a href="#imgs" aria-controls="imgs" role="tab" data-toggle="tab" id="imgs-tab">Location</a>
      </li>
      <li role="presentation">
        <a href="#events" aria-controls="events" role="tab" data-toggle="tab" id="events-tab">content</a>
      </li>
      <li role="presentation">
        <a href="#knowledge" aria-controls="knowledge" role="tab" data-toggle="tab" id="knowledge-tab">knowledge</a>
      </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">

      <!-- imgs -->
      <div role="tabpanel" class="tab-pane fade in active" id="imgs">
        <div class="container imgcontainer">
          <!-- this section shows a list of selected images, -->
          <div class="page-header">
            <h2>What happened here in the past? <!-- small>Subtext</small --></h2>
          </div>
          <!-- use a carousel widget -->
          <div class="bs">
            <div id="imgCarousel" class="carousel slide" data-ride="carousel">
              <!-- Indicators -->
              <ol class="carousel-indicators"></ol>
            </div>
          </div>
          <div class="new-caption-area"></div>
        </div>
      </div>

      <!-- events -->
      <div role="tabpanel" class="tab-pane fade" id="events">
        <div class="container">
          <!-- this section shows a list of preprared events -->
          <div class="page-header">
            <h2>What do the events look like? <!-- small>Subtext</small --></h2>
          </div>
          <!-- list widget -->
          <div id="eventList" class="list-group"></div>
        </div>
      </div>

      <!-- knowledge -->
      <div role="tabpanel" class="tab-pane fade" id="knowledge" >
        <div class="container" >
          <!-- this section shows all the events from different views on the time line-->
          <div class="page-header">
            <h2>Explore the history event knowledge base!</h2>
            <span>Note: fecets are automatically extracted from images</span>
          </div>
          <div class="row" id="timeview">
          <!-- this is a group of controls to select which subset of events to view on the time line -->
            <div class="list-group col-lg-4 col-md-4 col-xs-4">
              <span>Browse by:</span>
              <div class="show-group-item">
                <a id="warList">Period</a>
              </div>
              <div class="show-group-item">
                <a id="sceneList">Scene</a>
              </div>
              <div class="show-group-item">
                <a id="objectList">Object</a>
              </div>
            </div>
            <div class="col-lg-6 col-md-6 col-xs-6" id="pageTable"></div>
            <!-- this is a timeglider widget for viewing events on time line -->

          </div>
        </div>
      </div>
      <div id="timeglider" style="height:0px; "></div>

    </div>
  </div>

  <!-- common -->
  <script src="js/timeglider-1.0.3/jquery-1.9.1.min.js"></script>
  <script src="js/jquery-ui.min.js"></script>
  <script src="js/timestamp.js"></script>

  <script src="js/underscore-min.js"></script>
  <script src="js/parseUri.js"></script>
  <script src="js/widget.js"></script>
  <script src="js/bootstrap-3.3.6/bootstrap.min.js"></script>
  <script src="js/page.js"></script>
  <!-- timeglider -->

  <script src="js/timeglider-1.0.3/backbone-min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/ba-debug.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/jquery.tmpl.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/ba-debug.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/ba-tinyPubSub.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/jquery.mousewheel.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/jquery.ui.ipad.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/globalize.js" type="text/javascript" charset="utf-8"></script>

  <script src="js/timeglider-1.0.3/jquery-ui-1.10.3.custom.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/TG_Date.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/TG_Org.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/TG_Timeline.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/TG_TimelineView.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/TG_Mediator.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/timeglider-1.0.3/timeglider.timeline.widget.js" type="text/javascript"></script>
  <script src="js/timeglider-1.0.3/timeglider.datepicker.js" type="text/javascript"></script>

  <script src="js/timeglider-1.0.3/jquery.jscrollpane.min.js" type="text/javascript"></script>


  <script>
var imgJsonUrl = 'json/queryImg.json';
var eventJsonUrl = 'json/events.sample.json';
var browseJsonUrls = [
  '/lmHistoryTMMSuppData/demo/browseByWar.final.json',
  '/lmHistoryTMMSuppData/demo/browseByScene.final.json',
  '/lmHistoryTMMSuppData/demo/browseByObject.final.json'
];
var timeJsonUrl = 'testdata/history.json';
var timeRootJsonUrls = [
  '/lmHistoryTMMSuppData/demo/browseByWar/', 
  '/lmHistoryTMMSuppData/demo/browseByScene/', 
  '/lmHistoryTMMSuppData/demo/browseByObject/'
];

var imgData = undefined;
var eventData = undefined;
var browseData = [undefined, undefined, undefined];

function genPagedTableProcessFunc(browseIdx)
{
  return function(wordId)
  {
    return function(){
      // var jsonUrl = timeRootJsonUrls[browseIdx] + wordId + '.final.refine.json';
      var jsonUrl = timeRootJsonUrls[browseIdx] + wordId + '.final.refine.color.size.json';
      var timeGlider = new TimeGlider($('#timeglider'));
      timeGlider.GetData(jsonUrl);
    }
  };
}

$(document).ready(function() {

  // image tab
  // d is a list of [imgId, imgUrl]
  $.getJSON(imgJsonUrl, function(d) {

    imgData = d;
    var imgCarousel = new Carousel($('#imgCarousel'), d, {},
      function(item) {

        var imgUrl = commonUrls.imgQueryRootUrl + item[1];
        var imgId = item[0];
        // var imgName = "PLACE";
        var imgName = item[2];
        return '<div class="item"><img src="' + imgUrl +
          '" onclick="location.href=\'match.html?iid=' + imgId + '\'">' +
          '<div class="carousel-caption"><h3>' + imgName + '</h3></div></div>';
      });
  });

  // event tab
  $('#events-tab').click(function() {

    if(eventData != undefined) return;

    $.getJSON(eventJsonUrl, function(d) {
      eventData = d;

      // d is a list of [eid, text]
      var eventList = new ListView($('#eventList'), d,
        function(item) {

          //create and return html segment of text
          var eid = item[0];
          var txt = item[1]
          //return '<a href="event.html?eid=' + eid + '" class="list-group-item">' + txt + '</a>';
          return '<div class="list-group-item"><a href="event.html?eid=' + eid + '" class="list-link" target="_blank">&nbsp;</a>' + txt + '</div>';
        });
    });
  });

  var rows = [4, 3, 3];
  var cols = [1, 2, 4];
  // knowledge tab
  _.each(['#warList', '#sceneList', '#objectList'], function(d, i) {
    $(d).click(function() {

      var param = {rows: rows[i], cols: cols[i]};
      if(browseData[i] != undefined){
        // refresh paged table with stored data
        var pagedTable = new PagedTable($('#pageTable'), browseData[i], param, genPagedTableProcessFunc(i));
      }
      else
      {
        // d is a list of [wordId, word]
        $.getJSON(browseJsonUrls[i], function (d) {
          // get data to refresh paged table

          browseData[i] = d;
          var pagedTable = new PagedTable($('#pageTable'), d, param,
            genPagedTableProcessFunc(i));
        });// get json
      }
    });//d.click
  });

  // initialize timeGlider in knowledge tab
  var timeGlider = new TimeGlider($('#timeglider'));
  timeGlider.GetData(timeJsonUrl);

  // control the display for timeGlider
  $('#imgs-tab').click(function(){
    $('#timeglider').attr("style", "display:none; height:0px");
  })
  $('#events-tab').click(function(){
    $('#timeglider').attr("style", "display:none; height:0px");
  })
  $('#knowledge-tab').click(function(){
    $('#timeglider').attr("style", "display:block; height:550px");
  })

});
  </script>
</body>
